const fs = require('fs');
const path = require('path');

let directory_name = path.join(__dirname, '../methods');
 

const generateRegistryFile = () =>{
// Function to get current filenames
// in directory
const files = fs.readdirSync(directory_name);
const entries = files.map((file) => {
    const fileContent = fs.readFileSync(path.join(__dirname, '../methods/', file)).toString();
    return JSON.parse(fileContent);
}).sort((a, b)=>{
    return a.name > b.name ? 1 : -1;
})

console.log(JSON.stringify(entries, null, 2))

const template = `

<!-- DO NOT EDIT THIS FILE -->
<!-- This section of the registry is generated from the json files in the methods directory -->
<!-- See the register did method pull request template for details -->

<section id="did-method-registry">
    <h1>Generated DID Methods</h1>

    <table class="simple">
    <thead>
      <tr>
        <th>Method Name</th>
        <th>Registry</th>
        <th>Contact</th>
        <th>Status</th>
      </tr>
      <tbody>
      ${entries.map((e)=>{
        return `
<tr>

<td>
<a href="${e.specification}">did:${e.name}:</a>
</td>


<td>
${e.registry}
</td>

<td>
${e.contact}
</td>

<td>
${e.status}
</td>

</tr>
      `
      }).join('\n')}
      </tbody>
    </thead>
  </table>
</section>
`
fs.writeFileSync(
path.resolve(__dirname, '../sections/did-method-registry.html'),
    template,
);  
}

generateRegistryFile();